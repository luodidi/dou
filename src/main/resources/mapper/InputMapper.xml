<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.whut.dao.IInputDao">
    <!--
    添加录入检查表
    -->
    <insert id="insertInput" parameterType="com.whut.bean.Input">
        insert into input
        values
        (
        #{id},
        #{checkTableId},
        #{userName},
        #{deptId},
        #{checkDate},
        #{deptedId},
        #{isQualified},
        #{desc},
        #{type},
        #{otherPerson}
        )
    </insert>

    <!--
    添加隐患的信息
    -->
    <insert id="insetHiddenDanger" parameterType="com.whut.bean.HiddenDanger">
        insert into hiddendanger
        values
        (
        NULL,
        #{inputId},
        #{type},
        #{hPhoto},
        #{status},
        #{startDate},
        #{endDate},
        #{finishDate},
        #{rPhoto},
        #{desc},
        #{isFile},
        #{dispatchUserId},
        #{dispatchDeptId},
        #{deptId},
        #{content}
        )
    </insert>

    <!--
    添加二级指标的具体内容
    -->
    <insert id="insertCheckTableDetail" parameterType="com.whut.bean.CheckTableDetail">
        insert into checkdetail
        values
        (
        #{inputId},
        #{secondLevelIndicatorId},
        #{isQualified},
        #{desc}
        )
    </insert>

    <!--
    由隐患id获得其详情
    -->
    <select id="getDetailHiddenDanger" resultType="java.util.Map" parameterType="java.lang.Integer">
        select

        h.id,
        c.name checkTableName,
        h.type,
        h.hPhoto,
        h.status,
        h.startDate,
        h.endDate,
        h.finishDate,
        h.rPhoto,
        h.desc,
        h.isFile,
        u.name dispatchUserName,
        dIng.name dispatchDeptName,<!--下发整改的部门-->
        dEd.name deptName,<!--负责整改的部门-->
        h.content

        from

        hiddendanger as h,
        user as u,
        department dEd,
        department dIng,
        input as i,
        checktables as c

        where

        h.id=#{hiddenDangerId}
        and i.id=h.inputId and c.id=i.checkTableId
        and h.dispatchUserId=u.id
        and dIng.id=h.dispatchUserId
        and dEd.id=h.dispatchDeptId

    </select>

    <!--
    由录入表id获得其详情
    -->
    <select id="getDetailInput" resultType="java.util.Map" parameterType="java.lang.Integer">
        select

        i.id,
        c.name checkTableName,
        i.userName,   <!--检查人的姓名-->
        dIng.name deptName,
        i.checkDate,
        dEd.name deptedName,
        i.isQualified,
        i.desc,
        i.type,
        i.otherPerson

        from

        input as i,
        checktables as c,
        department as dIng,
        department as dEd

        where

        i.checkTableId=c.id
        and dIng.id=i.deptId
        and dEd.id=i.deptedId

    </select>

    <!--
    获取录入表列表（分页）
    -->
    <select id="getListInput" resultType="java.util.Map">
        select

        i.id,
        c.name checkTableName,
        i.userName,   <!--检查人的姓名-->
        dIng.name deptName,
        i.checkDate,
        dEd.name deptedName,
        i.isQualified,
        i.desc,
        i.type,
        i.otherPerson

        from

        input as i,
        checktables as c,
        department as dIng,
        department as dEd

        where

        i.checkTableId=c.id
        and dIng.id=i.deptId
        and dEd.id=i.deptedId
    </select>
</mapper>